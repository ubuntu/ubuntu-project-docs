(how-to-sponsor-an-upload)=
# How to sponsor an upload

Use these instructions when sponsoring an upload.

:::{admonition} **Sponsorship** series
The article series provides guidance on requesting sponsorship and sponsoring.

Overview:
:   * {ref}`sponsorship`

For contributors:
:   * {ref}`how-to-find-a-sponsor`
    * {ref}`how-to-request-an-upload`
    * {ref}`how-to-request-a-sync`

For sponsors:
:   * {ref}`how-to-review-a-merge-proposal`
    * {ref}`how-to-sponsor-an-upload` (this article)
    * {ref}`how-to-sponsor-a-sync`
:::

If you are interested in {ref}`sponsoring <sponsorship>`, and have gained upload rights, you can join the {term}`Ubuntu sponsors` team (and {term}`Ubuntu security sponsors`) to be notified of new requests in the [sponsorship queue](http://sponsoring-reports.ubuntu.com/). See {ref}`path-to-upload-rights` for details on how to apply for upload rights.


(sponsor-a-package)=
## Sponsor a package

This is similar to uploading your own `.changes` file, except that after ensuring the upload follows all quality standards (see {ref}`how-to-review-a-merge-proposal`), you sign the content of the proposing person with your key and upload it to the Ubuntu Archive instead of a PPA.

:::{note}
These instructions assume the request for sponsorship is in the form of a {term}`merge proposal`. See *How can I convert a debdiff contribution into a git-ubuntu branch?* under {external+git-ubuntu:doc}`howto/patch-pilot` for guidance on working with a 'traditional' contribution in the form of a patch generated by the {manpage}`debdiff(1)` tool.
:::

1. Clone the package repository and change to the created directory:

    ```none
    $ git ubuntu clone <package>
    $ cd <package>
    ```

1. Add the Launchpad ID for which you're sponsoring as a Git `remote`:

    ```none
    $ git ubuntu remote add <sponsored_LP_user>
    ```

1. Switch to the merge-proposal branch:

    ```none
    $ git checkout "<sponsoree_LP_user>/<MP_branch_name>" -b "<MP_branch_name>"
    ```

1. Generate the `orig` tarballs for the source package:

    ```none
    $ git ubuntu export-orig
    ```

   In case the upload is for a {term}`merge`, add the `--for-merge` flag:

    ```none
    $ git ubuntu export-orig --for-merge
    ```

1. Push the branch to your Launchpad namespace:

    ```none
    $ upload_args=$(git ubuntu prepare-upload args)
    ```

   This command generates arguments for the build step to include the appropriate header reference to the rich history in the {file}`.changes` file and stores the output in the `upload_args` variable.

1. Build the source package (with arguments generated in the previous step -- and stored in the `upload_args` variable -- appended to the command):

    ```none
    $ debuild --build=source --no-check-builddeps \
              --unsigned-changes --unsigned-source \
              ${upload_args}
    ```

   The same command with short options:

    ```none
    $ debuild -S -d -uc -us ${upload_args}
    ```

   :::{note}
   Use your preferred build method ({command}`debuild`, {command}`sbuild`, {command}`dpkg-buildpackage`), but always append `${upload_args}`.
   :::

   In case the upload is for a {term}`merge` in which the {file}`changelog` has more than one entry compared to the version in the release pocket (e.g. uploading `2.0-1ubuntu1`, and the previous Ubuntu version was `1.1-1ubuntu1`), add the `-v` flag with the previous Ubuntu version to include the changelog entries between the previous Debian base and the new Debian base:

    ```none
    $ debuild -S -d -uc -us -v1.1-1ubuntu1 ${upload_args}
    ```

1. Do a final check of the {file}`.changes` file:

    ```none
    $ less <package>_<version>_source.changes
    ```

   Check that:

   * The {file}`changelog` references the Launchpad bug to be closed by the upload.
   * For new upstream releases, the upstream `orig` tarball is included.
   * The {command}`git-ubuntu` branch is mentioned.

   See {ref}`how-to-review-a-merge-proposal` for general review details.

1. Sign the {file}`.changes` file:

    ```none
    $ cd ..
    $ debsign -k$DEBSIGN_KEYID <package>_<version>_source.changes
    ```

1. Upload the package:

    ```none
    $ dput ubuntu <package>_<version>_source.changes
    ```

## Signing methods

To ensure your GPG key is automatically used to sign all uploads, including sponsored ones, you can set the following in the {file}`~/.devscripts` configuration file (see also the {manpage}`debuild(1)` manual page):

```shell
DEBUILD_DPKG_BUILDPACKAGE_OPTS="-k'Jane Packager <jpkg@example.com>' -sa"
```

For this setting to take effect, modify the {command}`debuild` build command to omit the `-uc` and `-us` flags, which prevent signing (the same applies to builds with {command}`dpkg-buildpackage`). For example:

```none
$ debuild -S -d ${upload_args}
```

Then do _not_ run the {command}`debsign` command.

:::{admonition} `$DEBSIGN_KEYID` and `$DEB_SIGN_KEYID`
The {command}`debsign` and {command}`dpkg-buildpackage` tools use similar variable names for GPG keys. Do not confuse them:

| tool                         | variable          | manual page                     |
| ---                          | ---               | ---                             |
| {command}`debsign`           | `$DEBSIGN_KEYID`  | {manpage}`debsign(1)`           |
| {command}`dpkg-buildpackage` | `$DEB_SIGN_KEYID` | {manpage}`dpkg-buildpackage(1)` |
:::


## Further reading

* {external+git-ubuntu:doc}`index`
